<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="A way to speed up your test-driven PHP development through automation..."><meta property="og:type" content="article"><meta property="og:title" content="Automocking Dependencies"><meta property="og:url" content="https://modethirteen.com/2014/02/25/automocking-dependencies/index.html"><meta property="og:site_name" content="al&#x3D;0x13"><meta property="og:description" content="A way to speed up your test-driven PHP development through automation..."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://modethirteen.com/2014/02/25/automocking-dependencies/photo-1546900703-cf06143d1239.jpg"><meta property="article:published_time" content="2014-02-25T18:57:45.000Z"><meta property="article:modified_time" content="2020-11-26T17:36:18.000Z"><meta property="article:author" content="James Andrew Vaughn (Andy)"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Testing"><meta property="article:tag" content="PHP"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://modethirteen.com/2014/02/25/automocking-dependencies/photo-1546900703-cf06143d1239.jpg"><meta name="twitter:creator" content="@modethirteen"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>Automocking Dependencies</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/rtl.css"><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="al=0x13" type="application/atom+xml">
</head><body class="max-width mx-auto px3 ltr"><div id="header-post"><a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fas fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/archives">Posts</a></li><li><a href="/#projects">Projects</a></li><li><a href="/atom.xml">Atom</a></li><li><a href="/plan">.plan</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="/2014/11/10/continuous-delivery-without-breaking-everything/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://modethirteen.com/2014/02/25/automocking-dependencies/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&text=Automocking Dependencies"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&is_video=false&description=Automocking Dependencies"><i class="fab fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Automocking Dependencies&body=Check out this article: https://modethirteen.com/2014/02/25/automocking-dependencies/"><i class="fas fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-digg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&name=Automocking Dependencies&description="><i class="fab fa-tumblr" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://modethirteen.com/2014/02/25/automocking-dependencies/&t=Automocking Dependencies"><i class="fab fa-hacker-news" aria-hidden="true"></i></a></li></ul></div><div id="toc"></div></span></div><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Automocking Dependencies</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">James Andrew Vaughn (Andy)</span></span><div class="postdate"><time datetime="2014-02-25T18:57:45.000Z" itemprop="datePublished">2014-02-25</time></div><div class="article-tag"><i class="fas fa-tag"></i> <a class="tag-link-link" href="/tags/PHP/" rel="tag">PHP</a>, <a class="tag-link-link" href="/tags/Programming/" rel="tag">Programming</a>, <a class="tag-link-link" href="/tags/Testing/" rel="tag">Testing</a></div></div></header><div class="content" itemprop="articleBody"><p class="description">A way to speed up your test-driven PHP development through automation...</p><p><img src="/2014/02/25/automocking-dependencies/photo-1546900703-cf06143d1239.jpg" alt="Image"><span class="caption">Image: <a target="_blank" rel="noopener" href="https://unsplash.com/@goshua13">Joshua Aragon</a></span></p><p><em>Update 2020-11-26</em>: I‚Äôve updated this post to reflect the new <a target="_blank" rel="noopener" href="https://github.com/modethirteen/OpenContainer">OpenContainer repository location and PHP 7.4 syntax</a>.</p><p>I created <a target="_blank" rel="noopener" href="https://github.com/modethirteen/OpenContainer">OpenContainer</a> to assist in the refactoring of legacy PHP code at <a target="_blank" rel="noopener" href="https://mindtouch.com/">MindTouch</a>. The goal was to shore up the stability of the codebase as we transitioned from six-month waterfall-driven software delivery cycles to continuous delivery twice per week. While the majority of critical business logic was implemented and exposed via APIs in a C# codebase with (fairly) okay test coverage, PHP was used to marshall data from these APIs and deliver a product experience. There were two major challenges to achieving reasonable stability and reliability for the PHP codebase:</p><ul><li>The codebase lacked any automated unit or integration testing</li><li>Nearly all code relied on static functions or global state, with no formalization in code of the relationship between dependencies</li></ul><p>The latter situation, in particular, got under my skin. I‚Äôve never particularly been a fan of dynamic or loosely typed languages (it bothers me that we are so quick to throw decades worth of type system research out the window for so-called flexibility). Just about every global variable that could be mutated from anywhere across the codebase was mutated, usually as side effects of seemingly unrelated routines. If code paths were going to be tested, I first needed to understand what these paths were and to do that I had to define what was needed (depended upon) for any given scenario.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XyzzyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">newXyzzy</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$wgXyzzySettings</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Xyzzy(<span class="variable">$wgXyzzySettings</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getXyzzy</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$wgSomeUnrelatedApplicationState</span>, <span class="variable">$wgXyzzySettings</span>;</span><br><span class="line">        <span class="variable">$wgSomeUnrelatedApplicationState</span> = <span class="string">&#x27;plugh&#x27;</span>;</span><br><span class="line">        <span class="variable">$wgXyzzySettings</span> = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;baz&#x27;</span> =&gt; <span class="string">&#x27;qux&#x27;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> XyzzyService::getXyzzy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Oh yea, there is absolutely nothing wrong with that scenario at all. <code>XyzzyFactory::newXyzzy</code> relies on a global variable that is set out-of-band in the function that calls it. <code>Foo::getXyzzy</code> cannot set different factory settings for testing and mutates a seemingly unrelated application state variable and ruins some other downstream component‚Äôs day.</p><p>I‚Äôm a tremendous fan of dependency injection as a concept (particularly by object constructor). With dependency injection properly leveraged, not only do I understand what the bare minimum requirements are for a software component to work, but the dependencies themselves can be provided as interfaces, with their actual implementations provided by particular use cases.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XyzzyService</span> <span class="keyword">implements</span> <span class="title">IXyzzyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IXyzzySettings <span class="variable">$settings</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__constructor</span>(<span class="params">IContainer <span class="variable">$container</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$settings</span> = <span class="variable">$container</span>-&gt;IXyzzySettings;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">newXyzzy</span>(<span class="params"></span>) : <span class="title">IXyzzy</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Xyzzy(<span class="keyword">$this</span>-&gt;settings);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IXyzzySettings <span class="variable">$settings</span>;</span><br><span class="line">    <span class="keyword">private</span> IXyzzyService <span class="variable">$service</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__constructor</span>(<span class="params">IContainer <span class="variable">$container</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$settings</span> = <span class="variable">$container</span>-&gt;IXyzzySettings;</span><br><span class="line">        <span class="variable">$settings</span>-&gt;set(<span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;qux&#x27;</span>);</span><br><span class="line">        <span class="variable">$service</span> = <span class="variable">$container</span>-&gt;IXyzzyService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getXyzzy</span>(<span class="params"></span>) : <span class="title">IXyzzy</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;service-&gt;newXyzzy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here I have achieved two benefits. <code>Foo</code> and <code>XyzzyService</code> both clearly define their outside dependencies by fetching them from a shared container. No untraceable global variables are overwritten, and I can step through this code in a debugger. I‚Äôd likely have a problem with the <code>Foo::__construct</code> method changing the internal state of the container‚Äôs <code>IXyzzySettings</code> instance, but the point is: at least I can track that down and identify when components may be altering state in a way that creates unintended consequences. Furthermore, now that the dependencies for <code>Foo</code> and <code>XyzzyService</code> are provided as interfaces, I can implement whatever state I want for <code>IXyzzySettings</code>. When I test <code>Foo</code>, I can even substitute a mock or dummy object for <code>IXyzzyService</code>, which leads me into mocking this container - or more specifically, <em>automocking</em>.</p><p>Automocking is what greatly increased my ability to quickly write tests to cover the behavior that I was converting from static and global implementations. The process went something like this: manually test the desired ‚Äúhot‚Äù paths (based on the original product spec, if it existed), update the code, manually test again, lock down the behavior with a unit test, rinse, and repeat. Automocking removed the need to individually create mocks for all the possible dependencies that could exist in the container. It can be very tedious to identify all injected dependencies in an object and set them up as mocks in the event that they <em>may</em> be needed for a particular test. Failure to do so would often lead to null reference exceptions in the object‚Äôs constructor when just trying to initialize it for testing.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Qux</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__constructor</span>(<span class="params">IContainer <span class="variable">$container</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$bar</span> = <span class="variable">$container</span>-&gt;IBar</span><br><span class="line">        <span class="variable">$value</span> = <span class="variable">$container</span>-&gt;IFoo-&gt;getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For this scenario, I only need to test <code>Qux</code> with different implementations of <code>IBar</code>, but this object can‚Äôt initialize because <code>IFoo</code> is not mocked and <code>getValue</code> is called on a null reference. That‚Äôs pretty annoying - I have to mock a dependency I don‚Äôt care about. If only someone <em>else</em> could do it! üòÇ</p><p>The following sections assume that you have checked out <a target="_blank" rel="noopener" href="https://github.com/modethirteen/OpenContainer">OpenContainer</a> and have familiarized yourself with the library. In short, the key piece we will leverage here is the <code>@property</code> PHPDoc value that we use with OpenContainer to create type hint friendly container dependencies (if you have a PHP IDE with intellisense such as <a target="_blank" rel="noopener" href="https://www.jetbrains.com/phpstorm">JetBrains PHPStorm</a>).</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">modethirteen</span>\<span class="title">OpenContainer</span>\<span class="title">IContainer</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * in order for us to automock these properties</span></span><br><span class="line"><span class="comment"> * fully-qualified class names must be included</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> \My\Application\IFoo $IFoo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> \My\Application\IBar $IBar</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> \My\Application\IQux $IQux</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IApplicationContainer</span> <span class="keyword">extends</span> <span class="title">IContainer</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This container interface contains type hints for all the possible dependencies that could be registered in this container. One drawback to this approach is that it takes some diligence to remember to add a <code>@property</code> to the interface every time a new dependency is registered in the container. Our new <code>MockContainer</code> will implement this interface and provide some behavior to automatically generate <a target="_blank" rel="noopener" href="https://github.com/sebastianbergmann/phpunit">PHPUnit</a> mocks for these dependencies.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">phpDocumentor</span>\<span class="title">Reflection</span>\<span class="title">DocBlockFactory</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">Matcher</span>\<span class="title">AnyInvokedCount</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">MockBuilder</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">MockObject</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">TestCase</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">ReflectionClass</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockContainer</span> <span class="keyword">implements</span> <span class="title">IApplicationContainer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> object[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$instances</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> MockObject[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@structure</span> [type] =&gt; MockObject</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$mocks</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> object[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@structure</span> [type] =&gt; object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$proxyInstances</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> TestCase</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$testCase</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@structure</span> [type] =&gt; &#x27;class&#x27;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$typesToMock</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> TestCase $testCase</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">TestCase <span class="variable">$testCase</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;testCase = <span class="variable">$testCase</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// we&#x27;ll lazily build mocks from interface PHPdoc @property values</span></span><br><span class="line">        <span class="variable">$factory</span> = DocBlockFactory::createInstance();</span><br><span class="line">        <span class="variable">$docBlock</span> = <span class="variable">$factory</span></span><br><span class="line">            -&gt;create(</span><br><span class="line">               (<span class="keyword">new</span> ReflectionClass(IApplicationContainer::class))</span><br><span class="line">                   -&gt;getDocComment()</span><br><span class="line">            );</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$docBlock</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$docBlock</span>-&gt;getTagsByName(<span class="string">&#x27;property&#x27;</span>) <span class="keyword">as</span> <span class="variable">$tag</span>) &#123;</span><br><span class="line">            [<span class="variable">$class</span>, <span class="variable">$type</span>] = explode(<span class="string">&#x27; &#x27;</span>, strval(<span class="variable">$tag</span>));</span><br><span class="line">            <span class="variable">$type</span> = ltrim(<span class="variable">$type</span>, <span class="string">&#x27;$&#x27;</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;typesToMock[<span class="variable">$type</span>] = <span class="variable">$class</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Always prefer registered instances to mocks</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$id</span></span>) : <span class="title">object</span> </span>&#123;</span><br><span class="line">        <span class="variable">$instance</span> = <span class="keyword">$this</span>-&gt;instances[<span class="variable">$id</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$instance</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$instance</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$mock</span> = <span class="keyword">$this</span>-&gt;getMock(<span class="variable">$id</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$mock</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$mock</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CannotLoadInvalidMockInstanceException(<span class="variable">$id</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isRegistered</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$id</span></span>) : <span class="title">bool</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get a mock out of the container to setup expectations</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> MockObject|null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getMock</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$id</span></span>) : ?<span class="title">MockObject</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;mocks[<span class="variable">$id</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;mocks[<span class="variable">$id</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$mock</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;typesToMock[<span class="variable">$id</span>])) &#123;</span><br><span class="line">            <span class="variable">$class</span> = <span class="keyword">$this</span>-&gt;typesToMock[<span class="variable">$id</span>];</span><br><span class="line">            <span class="variable">$builder</span> = <span class="keyword">new</span> MockBuilder(<span class="keyword">$this</span>-&gt;testCase, <span class="variable">$class</span>);</span><br><span class="line">            <span class="variable">$mock</span> = <span class="variable">$builder</span></span><br><span class="line">                -&gt;setMethods(get_class_methods(<span class="variable">$class</span>))</span><br><span class="line">                -&gt;disableOriginalConstructor()</span><br><span class="line">                -&gt;getMock();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;mocks[<span class="variable">$id</span>] = <span class="variable">$mock</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$mock</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Register an instance that provides concrete properties and functions</span></span><br><span class="line"><span class="comment">     * that can be overridden with mocked properties and functions</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object $instance</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">proxyMock</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$id</span>, <span class="keyword">object</span> <span class="variable">$instance</span></span>) : <span class="title">void</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;proxyInstances[<span class="variable">$id</span>])) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;proxyInstances[<span class="variable">$id</span>] = <span class="variable">$instance</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;proxyInstances[<span class="variable">$id</span>] = <span class="variable">$instance</span>;</span><br><span class="line">        <span class="variable">$mock</span> = <span class="keyword">$this</span>-&gt;getMock(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// proxy each mock method to instance method</span></span><br><span class="line">        <span class="keyword">foreach</span>(get_class_methods(<span class="variable">$instance</span>) <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$method</span> === <span class="string">&#x27;__clone&#x27;</span> || <span class="variable">$method</span> === <span class="string">&#x27;__construct&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$mock</span>-&gt;expects(<span class="keyword">new</span> AnyInvokedCount())</span><br><span class="line">                -&gt;method(<span class="variable">$method</span>)</span><br><span class="line">                -&gt;willReturnCallback(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="title">use</span> (<span class="params"><span class="variable">$id</span>, <span class="variable">$method</span></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> call_user_func_array([</span><br><span class="line">                        <span class="keyword">$this</span>-&gt;proxyInstances[<span class="variable">$id</span>],</span><br><span class="line">                        <span class="variable">$method</span></span><br><span class="line">                    ], func_get_args());</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Register a mock object</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> MockObject $mock</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">registerMock</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$id</span>, MockObject <span class="variable">$mock</span></span>) : <span class="title">void</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mocks[<span class="variable">$id</span>] = <span class="variable">$mock</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Remove any registered instance or mock</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">flushInstance</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$id</span></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;instances[<span class="variable">$id</span>]);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;mocks[<span class="variable">$id</span>]);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;proxyInstances[<span class="variable">$id</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Register a callback that builds an instance</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Closure $builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">registerBuilder</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$id</span>, <span class="built_in">Closure</span> <span class="variable">$builder</span></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Register an instance</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object $instance</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">registerInstance</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$id</span>, <span class="keyword">object</span> <span class="variable">$instance</span></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;instances[<span class="variable">$id</span>] = <span class="variable">$instance</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Register a class type</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $class</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">registerType</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$id</span>, <span class="keyword">string</span> <span class="variable">$class</span></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Our <code>MockContainer</code> uses <a target="_blank" rel="noopener" href="https://github.com/phpDocumentor/phpDocumentor">phpDocumentor</a> and PHPUnit to parse our container interface <code>@property</code> values and auto-generate mocks. In our tests, we can now <code>MockContainer::getMock</code> any dependency we need to set expectations on. We can use <code>MockContainer::proxyMock</code> to provide a concrete instance, with optional mocked properties and functions - a sort of hybrid approach that is influenced by JavaScript testing practices like <a target="_blank" rel="noopener" href="https://jasmine.github.io/2.0/introduction#section-Spies">spies</a>.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">TestCase</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IApplicationContainer <span class="variable">$container</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setUp</span>(<span class="params"></span>) : <span class="title">void</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;container = <span class="keyword">new</span> MockContainer(<span class="keyword">$this</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;container-&gt;getMock(<span class="string">&#x27;IBar&#x27;</span>)</span><br><span class="line">            -&gt;expects(<span class="built_in">static</span>::any())</span><br><span class="line">            -&gt;method(<span class="string">&#x27;getSomething&#x27;</span>)</span><br><span class="line">            -&gt;will(<span class="built_in">static</span>::returnValue(<span class="string">&#x27;123&#x27;</span>));</span><br><span class="line">        <span class="keyword">$this</span>-&gt;container-&gt;proxyMock(<span class="string">&#x27;IQux&#x27;</span>, <span class="keyword">new</span> Qux());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@test</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) : <span class="title">void</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// this test has a very specific value it needs IQux to return</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;container-&gt;getMock(<span class="string">&#x27;IQux&#x27;</span>)</span><br><span class="line">            -&gt;expects(<span class="built_in">static</span>::once())</span><br><span class="line">            -&gt;method(<span class="string">&#x27;getSomethingElse&#x27;</span>)</span><br><span class="line">            -&gt;will(<span class="built_in">static</span>::returnValue(<span class="string">&#x27;456&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Applying these patterns has transformed a codebase that was responsible for a production bug nearly every week, to arguably one of the most covered with tests and most reliable in the entire platform. That level of confidence has a huge benefit on developer morale, especially on those who may be new to the codebase and are concerned with introducing bugs in an unfamiliar environment. Reliable dependency management and testing won‚Äôt ever entirely eliminate bugs (your unique production situations and data will always see to that), but it can get you very close!</p></div></article><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/archives">Posts</a></li><li><a href="/#projects">Projects</a></li><li><a href="/atom.xml">Atom</a></li><li><a href="/plan">.plan</a></li></ul></div><div id="toc-footer" style="display:none"></div><div id="share-footer" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://modethirteen.com/2014/02/25/automocking-dependencies/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&text=Automocking Dependencies"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&is_video=false&description=Automocking Dependencies"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Automocking Dependencies&body=Check out this article: https://modethirteen.com/2014/02/25/automocking-dependencies/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&title=Automocking Dependencies"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://modethirteen.com/2014/02/25/automocking-dependencies/&name=Automocking Dependencies&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://modethirteen.com/2014/02/25/automocking-dependencies/&t=Automocking Dependencies"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a> <a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a> <a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2014-2020 James Andrew Vaughn (Andy)</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/archives">Posts</a></li><li><a href="/#projects">Projects</a></li><li><a href="/atom.xml">Atom</a></li><li><a href="/plan">.plan</a></li></ul></nav></div></footer></div><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css"><script src="/lib/jquery/jquery.min.js"></script><script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">$((function(){$(".highlight table").before('<span class="btn-copy tooltipped tooltipped-sw" aria-label="Copy to clipboard!"><i class="far fa-clone"></i></span>'),new ClipboardJS(".btn-copy",{text:function(e){return Array.from(e.nextElementSibling.querySelectorAll(".code")).reduce((e,t)=>e+t.innerText+"\n","")}}).on("success",(function(e){e.trigger.setAttribute("aria-label","Copied!"),e.clearSelection()}))}))</script><script src="/js/main.js"></script></body></html>